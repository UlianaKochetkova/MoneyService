pipeline {
    agent any
    environment {
        dockerContainerName = 'moneyservice'
        dockerImageName = 'moneyservice-api'
    }
    stages {
    stage('Copy Artifacts') {
             steps {
                 script {
                    step ([$class: 'CopyArtifact',
                        projectName: 'build_test_job/com$MoneyService',
                        filter: "**/*.jar",
                        target: 'temp_money_service1']);
                }
            }
        }

    stage('clean container') {
          steps {
           sh 'docker ps -f name=${dockerContainerName} -q | xargs --no-run-if-empty docker container stop'
           sh 'docker container ls -a -fname=${dockerContainerName} -q | xargs -r docker container rm'
           sh 'docker images -q --filter=reference=${dockerImageName} | xargs --no-run-if-empty docker rmi -f'
          }
        }
    stage('docker-compose start') {
          steps {
           sh 'docker compose up -d'
          }
    }
    }
}